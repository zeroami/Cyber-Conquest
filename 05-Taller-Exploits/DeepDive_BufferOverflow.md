# И Taller de Exploits: Anatom铆a del Buffer Overflow

> "La memoria no es un lugar seguro si no controlas los l铆mites de escritura."

Este m贸dulo profundiza en una de las vulnerabilidades m谩s cl谩sicas y potentes de la seguridad inform谩tica, basada en la arquitectura de sistemas.

## 1. Conceptos de Memoria (El Stack)
Para comprender el desbordamiento, es vital entender la **Pila (Stack)**: un 谩rea de memoria din谩mica que almacena informaci贸n sobre las subrutinas activas de un programa.

### Estructura de un Stack Frame
Cuando se llama a una funci贸n, se reserva un espacio en la pila que contiene:
* **Argumentos:** Datos pasados a la funci贸n.
* **Return Address (RET):** La direcci贸n donde el programa debe continuar tras terminar la funci贸n. Si un atacante controla esto, controla el flujo del programa.
* **Saved EBP:** Puntero de la base del stack.
* **Variables Locales:** Los buffers de datos donde se almacenan variables temporales.


## 2. El Mecanismo del Ataque
Un **Buffer Overflow** ocurre cuando un programa escribe datos m谩s all谩 de los l铆mites asignados a un b煤fer en la memoria.

### Pasos de la Explotaci贸n:
* **Sobrescritura:** Se inunda el b煤fer con caracteres hasta sobrescribir la direcci贸n de retorno en la pila.
* **Secuestro del Flujo:** El atacante coloca una nueva direcci贸n de memoria en el espacio de la direcci贸n de retorno original para controlar la ejecuci贸n.
* **Ejecuci贸n de Shellcode:** La CPU salta a la direcci贸n controlada por el atacante, ejecutando su carga 煤til o **Shellcode**.

## 3. Ejemplo de C贸digo Vulnerable (C)
El uso de funciones que no verifican la longitud del input es la causa principal de este fallo. El siguiente ejemplo muestra c贸mo se puede corromper la memoria:

```c
void mi_funcion(char *input_usuario) {
    char buffer[64];
    // PELIGRO: strcpy no verifica si el input cabe en el buffer de 64 bytes
    strcpy(buffer, input_usuario);
}
```

## 4. Defensas Modernas
Para mitigar estos ataques, los sistemas operativos y compiladores actuales implementan las siguientes tecnolog铆as:

* **ASLR (Address Space Layout Randomization):** Aleatoriza las direcciones de memoria en cada ejecuci贸n para dificultar que el atacante prediga d贸nde saltar.

* **DEP/NX (Data Execution Prevention):** Marca ciertas 谩reas de la memoria (como el stack) como "no ejecutables", impidiendo que el shellcode se ejecute
incluso si se logra inyectar.

* **Canaries:** Valores secretos (canarios) colocados antes de la direcci贸n de retorno. Si el programa detecta que el valor ha sido modificado al terminar la funci贸n, 
se detiene antes de procesar el retorno para evitar la ejecuci贸n de c贸digo malicioso.
